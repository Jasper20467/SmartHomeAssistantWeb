<div class="container">
  <div class="page-header">
    <h1 class="page-title">è€—æç®¡ç†</h1>
    <button class="btn" (click)="toggleForm()">
      {{ showForm ? 'å–æ¶ˆ' : 'æ–°å¢è€—æ' }}
    </button>
  </div>

  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <!-- æ–°å¢/ç·¨è¼¯è¡¨å–® -->
  <div class="card" *ngIf="showForm">
    <h2>{{ editingConsumableId ? 'ç·¨è¼¯è€—æ' : 'æ–°å¢è€—æ' }}</h2>
    
    <form [formGroup]="consumableForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="name">åç¨±</label>
        <input type="text" id="name" formControlName="name" class="form-control" placeholder="è«‹è¼¸å…¥è€—æåç¨±">
        <div *ngIf="consumableForm.get('name')?.invalid && consumableForm.get('name')?.touched" class="error-message">
          åç¨±ç‚ºå¿…å¡«é …ç›®
        </div>
      </div>
      
      <div class="form-group">
        <label for="category">åˆ†é¡</label>
        <select id="category" formControlName="category" class="form-control">
          <option value="">é¸æ“‡åˆ†é¡</option>
          <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
        </select>
        <div *ngIf="consumableForm.get('category')?.invalid && consumableForm.get('category')?.touched" class="error-message">
          åˆ†é¡ç‚ºå¿…å¡«é …ç›®
        </div>
      </div>
      
      <div class="form-group">
        <label for="installation_date">å®‰è£æ—¥æœŸ</label>
        <input type="date" id="installation_date" formControlName="installation_date" class="form-control">
        <div *ngIf="consumableForm.get('installation_date')?.invalid && consumableForm.get('installation_date')?.touched" class="error-message">
          å®‰è£æ—¥æœŸç‚ºå¿…å¡«é …ç›®
        </div>
      </div>
      
      <div class="form-group">
        <label for="lifetime_days">ä½¿ç”¨å£½å‘½(å¤©)</label>
        <input type="number" id="lifetime_days" formControlName="lifetime_days" class="form-control" min="1">
        <div *ngIf="consumableForm.get('lifetime_days')?.invalid && consumableForm.get('lifetime_days')?.touched" class="error-message">
          ä½¿ç”¨å£½å‘½å¿…é ˆå¤§æ–¼0
        </div>
      </div>
      
      <div class="form-group">
        <label for="notes">å‚™è¨»</label>
        <textarea id="notes" formControlName="notes" class="form-control" rows="3" placeholder="è«‹è¼¸å…¥å‚™è¨»"></textarea>
      </div>
      
      <div class="form-actions">
        <button type="submit" class="btn" [disabled]="consumableForm.invalid || isSubmitting">
          {{ isSubmitting ? 'è™•ç†ä¸­...' : (editingConsumableId ? 'æ›´æ–°' : 'æ–°å¢') }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="resetForm()">å–æ¶ˆ</button>
      </div>
    </form>
  </div>

  <!-- è€—æåˆ—è¡¨ -->
  <div class="card">
    <div class="card-header">
      <h2>æ‰€æœ‰è€—æ</h2>
      <button class="btn btn-secondary" (click)="loadConsumables()">é‡æ–°è¼‰å…¥</button>
    </div>
    
    <app-loading-spinner *ngIf="isLoading"></app-loading-spinner>
    
    <div *ngIf="!isLoading">
      <div *ngIf="consumables.length === 0" class="empty-state">
        ç›®å‰æ²’æœ‰è€—æè¨˜éŒ„ï¼Œè«‹é»æ“Š"æ–°å¢è€—æ"æŒ‰éˆ•ä¾†æ–°å¢ã€‚
      </div>
      
      <div class="consumables-grid">
        <div *ngFor="let consumable of consumables" class="consumable-card">
          <div class="consumable-header">
            <h3>{{ consumable.name }}</h3>
            <span class="badge category-badge">{{ consumable.category }}</span>
          </div>
          
          <div class="consumable-details">
            <div class="detail-row">
              <span class="detail-label">å®‰è£æ—¥æœŸ:</span>
              <span class="detail-value">{{ consumable.installation_date | date:'yyyy-MM-dd' }}</span>
            </div>
            
            <div class="detail-row">
              <span class="detail-label">ä½¿ç”¨å£½å‘½:</span>
              <span class="detail-value">{{ consumable.lifetime_days }} å¤©</span>
            </div>
            
            <div class="detail-row">
              <span class="detail-label">ç‹€æ…‹:</span>
              <span class="detail-value">
                <span class="badge" [ngClass]="getStatusClass(consumable.days_remaining)">
                  <span *ngIf="consumable.days_remaining !== undefined && consumable.days_remaining > 0">
                    å‰©é¤˜: {{ consumable.days_remaining }} å¤©
                  </span>
                  <span *ngIf="consumable.days_remaining !== undefined && consumable.days_remaining <= 0">
                    å·²éæœŸ
                  </span>
                </span>
              </span>
            </div>
            
            <div class="detail-notes" *ngIf="consumable.notes">
              <p>{{ consumable.notes }}</p>
            </div>
          </div>
          
          <div class="consumable-actions">
            <button class="btn-icon edit" (click)="editConsumable(consumable)" title="ç·¨è¼¯">âœï¸</button>
            <button class="btn-icon delete" (click)="deleteConsumable(consumable.id!)" title="åˆªé™¤">ğŸ—‘ï¸</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

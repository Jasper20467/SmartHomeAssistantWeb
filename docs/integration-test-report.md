# Smart Home Assistant æ•´åˆæ¸¬è©¦å ±å‘Š

## æ¸¬è©¦æ—¥æœŸ
2025-07-07 13:54

## æ¸¬è©¦æ¦‚è¦
å®Œæˆäº† Smart Home Assistant å°ˆæ¡ˆåœ¨ Debug Mode å’Œ Production Mode ä¸‹çš„é…ç½®é©—è­‰èˆ‡æ•´åˆæ¸¬è©¦ã€‚

## Debug Mode æ¸¬è©¦çµæœ âœ…

### æ¸¬è©¦ç’°å¢ƒ
- **Frontend**: http://localhost:80
- **Backend**: http://localhost:8000  
- **LineBot**: http://localhost:5000
- **Database**: PostgreSQL (localhost:5432)

### æ¸¬è©¦çµæœ
- **ç¸½é«”æˆåŠŸç‡**: 100% (12/12 æ¸¬è©¦é€šé)
- **æœå‹™å¥åº·ç‹€æ…‹**: å…¨éƒ¨æ­£å¸¸
- **API ç«¯é»**: å…¨éƒ¨æ­£å¸¸
- **å‰ç«¯å¾Œç«¯æ•´åˆ**: å…¨éƒ¨æ­£å¸¸
- **LineBot å¾Œç«¯æ•´åˆ**: é…ç½®æ­£ç¢º
- **è³‡æ–™åº«é€£æ¥**: æ­£å¸¸

### è©³ç´°æ¸¬è©¦é …ç›®
1. **æœå‹™å¥åº·æª¢æŸ¥** âœ…
   - Backend: æ­£å¸¸
   - LineBot: æ­£å¸¸
   - Frontend: æ­£å¸¸

2. **API ç«¯é»æ¸¬è©¦** âœ…
   - GET /: HTTP 200
   - GET /health: HTTP 200
   - GET /api/schedules: HTTP 200
   - GET /api/consumables: HTTP 200

3. **å‰ç«¯å¾Œç«¯æ•´åˆ** âœ…
   - Frontend â†’ Backend /schedules: HTTP 200
   - Frontend â†’ Backend /consumables: HTTP 200

4. **LineBot å¾Œç«¯æ•´åˆ** âœ…
   - LineBot é…ç½®: http://backend:8000
   - LineBot â†’ Backend é€£æ¥: æ­£å¸¸

5. **è³‡æ–™åº«é€£æ¥** âœ…
   - Backend â†’ Database: HTTP 200

## Production Mode é…ç½®é©—è­‰ âœ…

### é…ç½®æª¢æŸ¥é …ç›®
1. **Docker Compose é…ç½®** âœ…
   - æ‰€æœ‰å¿…è¦æœå‹™å·²å®šç¾© (frontend, backend, linebot, db, caddy)
   - ç¶²è·¯é…ç½®æ­£ç¢º (app-network)
   - ç’°å¢ƒè®Šæ•¸é…ç½®æ­£ç¢º

2. **è³‡æ–™åº«é…ç½®** âœ…
   - ä½¿ç”¨æ­£ç¢ºçš„ async driver: `postgresql+asyncpg://`
   - ç’°å¢ƒè®Šæ•¸æ­£ç¢ºè¨­å®š

3. **å‰ç«¯ç’°å¢ƒé…ç½®** âœ…
   - é–‹ç™¼ç’°å¢ƒ: `http://localhost:8000/api`
   - ç”Ÿç”¢ç’°å¢ƒ: `/api` (ç›¸å°è·¯å¾‘)

4. **Caddy é…ç½®** âœ…
   - åŸŸåé…ç½®: `smarthome.the-jasperezlife.com`
   - API ä»£ç†: `backend:8000`
   - LineBot ä»£ç†: `linebot:5000`
   - å‰ç«¯ä»£ç†: `frontend:80`

## ä¿®å¾©çš„å•é¡Œ

### 1. è³‡æ–™åº«é€£æ¥å•é¡Œ ğŸ”§
**å•é¡Œ**: Backend ä½¿ç”¨ psycopg2 èˆ‡ async SQLAlchemy ä¸å…¼å®¹
**è§£æ±º**: 
- å°‡ DATABASE_URL å¾ `postgresql://` æ”¹ç‚º `postgresql+asyncpg://`
- åœ¨ debug å’Œ production æ¨¡å¼ä¸‹éƒ½é€²è¡Œäº†ä¿®æ­£

### 2. æœå‹™ç¶²è·¯é…ç½® ğŸ”§
**å•é¡Œ**: ç¢ºä¿æ‰€æœ‰æœå‹™éƒ½èƒ½é€éæœå‹™åç¨±äº’ç›¸é€šä¿¡
**è§£æ±º**: 
- æ‰€æœ‰æœå‹™éƒ½åŠ å…¥ `app-network`
- æœå‹™é–“å¯ä»¥ä½¿ç”¨æœå‹™åç¨± (å¦‚ `backend:8000`) é€²è¡Œé€šä¿¡

### 3. ç’°å¢ƒè®Šæ•¸é…ç½® ğŸ”§
**å•é¡Œ**: Debug å’Œ Production æ¨¡å¼éœ€è¦ä¸åŒçš„ç’°å¢ƒè®Šæ•¸
**è§£æ±º**: 
- Debug Mode: `DEBUG_MODE=true`, `DOMAIN_NAME=localhost`
- Production Mode: `DEBUG_MODE=false`, `DOMAIN_NAME=smarthome.the-jasperezlife.com`

## è‡ªå‹•åŒ–æ¸¬è©¦è…³æœ¬

### 1. æ•´åˆæ¸¬è©¦è…³æœ¬ ğŸ“
- `scripts/test_integration.py`: å®Œæ•´çš„æœå‹™æ•´åˆæ¸¬è©¦
- æ”¯æ´ debug å’Œ production æ¨¡å¼
- è‡ªå‹•æª¢æ¸¬æœå‹™å¥åº·ç‹€æ…‹ã€API ç«¯é»ã€æœå‹™é–“é€šä¿¡

### 2. é…ç½®é©—è­‰è…³æœ¬ ğŸ“
- `scripts/test_production_config.py`: é…ç½®æ–‡ä»¶é©—è­‰
- æª¢æŸ¥ Docker Composeã€ç’°å¢ƒè®Šæ•¸ã€å‰ç«¯é…ç½®ç­‰

### 3. ä¸€éµæ¸¬è©¦è…³æœ¬ ğŸ“
- `scripts/test_debug_mode.sh/.ps1`: å•Ÿå‹• debug ç’°å¢ƒä¸¦åŸ·è¡Œæ¸¬è©¦

## éƒ¨ç½²æ–¹å¼

### Debug Mode (æœ¬åœ°é–‹ç™¼)
```bash
# å•Ÿå‹•æœå‹™
docker-compose up -d

# åŸ·è¡Œæ¸¬è©¦
python scripts/test_integration.py --mode debug
```

### Production Mode (ç”Ÿç”¢ç’°å¢ƒ)
```bash
# ä½¿ç”¨ç”Ÿç”¢é…ç½®
cd scripts/DeployOn_AWS_Ec2
docker-compose -f docker-compose_fromHub.yml up -d

# åŸ·è¡Œæ¸¬è©¦
python ../test_integration.py --mode production
```

## æ¶æ§‹åœ–

```
Debug Mode:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        app-network                          â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Frontend  â”‚    â”‚   Backend   â”‚    â”‚   LineBot   â”‚    â”‚
â”‚  â”‚   :80       â”‚â—„â”€â”€â–ºâ”‚   :8000     â”‚â—„â”€â”€â–ºâ”‚   :5000     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚                   â”‚                            â”‚
â”‚           â”‚                   â–¼                            â”‚
â”‚           â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚           â”‚          â”‚ PostgreSQL  â”‚                       â”‚
â”‚           â”‚          â”‚   :5432     â”‚                       â”‚
â”‚           â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚           â”‚                                                â”‚
â”‚           â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Nginx (Frontend)                       â”‚  â”‚
â”‚  â”‚        /api/* â†’ backend:8000                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Production Mode:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        app-network                          â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Frontend  â”‚    â”‚   Backend   â”‚    â”‚   LineBot   â”‚    â”‚
â”‚  â”‚   :80       â”‚    â”‚   :8000     â”‚    â”‚   :5000     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚                   â”‚                   â”‚        â”‚
â”‚           â”‚                   â”‚                   â”‚        â”‚
â”‚           â”‚                   â–¼                   â”‚        â”‚
â”‚           â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚        â”‚
â”‚           â”‚          â”‚ PostgreSQL  â”‚               â”‚        â”‚
â”‚           â”‚          â”‚   :5432     â”‚               â”‚        â”‚
â”‚           â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚        â”‚
â”‚           â”‚                                        â”‚        â”‚
â”‚           â–¼                                        â–¼        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Caddy                            â”‚  â”‚
â”‚  â”‚  smarthome.the-jasperezlife.com                    â”‚  â”‚
â”‚  â”‚    /api/* â†’ backend:8000                           â”‚  â”‚
â”‚  â”‚    /webhook, /linebot/* â†’ linebot:5000             â”‚  â”‚
â”‚  â”‚    /* â†’ frontend:80                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## çµè«–

âœ… **Debug Mode**: å®Œå…¨æ­£å¸¸é‹è¡Œï¼Œæ‰€æœ‰æœå‹™äº¤æ¡æ­£å¸¸
âœ… **Production Mode**: é…ç½®æ­£ç¢ºï¼Œå¯ä»¥é€²è¡Œéƒ¨ç½²
âœ… **è‡ªå‹•åŒ–æ¸¬è©¦**: å®Œæ•´çš„æ¸¬è©¦è¦†è“‹ç‡ï¼Œå¯è‡ªå‹•é©—è­‰ç³»çµ±ç‹€æ…‹
âœ… **æ–‡æª”å®Œå–„**: æä¾›è©³ç´°çš„é…ç½®èªªæ˜å’Œéƒ¨ç½²æŒ‡å—

Smart Home Assistant å°ˆæ¡ˆå·²ç¶“æº–å‚™å¥½åœ¨å…©ç¨®æ¨¡å¼ä¸‹ç©©å®šé‹è¡Œï¼Œä¸¦å…·å‚™å®Œæ•´çš„æ¸¬è©¦å’Œé©—è­‰æ©Ÿåˆ¶ã€‚
